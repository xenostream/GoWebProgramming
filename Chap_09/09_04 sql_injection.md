# SQL Injection

## SQL 인젝션이란 무엇인가
SQL 인젝션 공격 (SQL Injection) 생략 주입 공격은 Web 개발에서 가장 흔히 볼 보안 취약점의 일종입니다. 데이터베이스에서 조심스럽게 다루어야 정보를 얻을 수 있습니다. 또는 데이터베이스의 특징을 이용하여 사용자를 추가하거나 파일을 내보내거나 같은 일련의 악의적 인 작업을 수행 할 수 있습니다. 데이터베이스 내지 시스템 사용자의 최고 권한을 얻을 수조차있을 수 있습니다.

SQL 인젝션이 발생하는 원인은 프로그램이 사용자의 입력에 사용 필터링을 실시하지 않고, 공격자가 서버에 악성 SQL 검색 쿼리를 전송시켜 버리기 때문입니다. 프로그램이 공격자의 잘못 입력하는 검색어의 일부로 실행하고 원래의 검색 로직이 변경되지 예기치 않은 공격자가 손수 돌봐 만든 악성 코드를 실행하게됩니다.
## SQL 인젝션 삽화
많은 Web 개발자는 SQL 쿼리가 변경되는 것은 의식하지 않습니다. 따라서 SQL 쿼리를 신뢰할 수있는 명령으로 버립니다. 의외로 SQL 쿼리는 액세스 제어를 우회 할 수 있습니다. 따라서 신분 확인 및 권한 검사를 우회합니다. SQL 쿼리에서 호스트 시스템 레벨의 명령이 실행되어 버릴 수도 있습니다.

다음은 실제 예제로 SQL 주입 방법에 대해 자세히 설명합니다.

다음과 같은 간단한 로그인 폼을 생각합니다 :

<form action = "/ login"method = "POST">
<p> Username : <input type = "text"name = "username"/> </ p>
<p> Password : <input type = "password"name = "password"/> </ p>
<p> <input type = "submit"value = "로그인"/> </ p>
</ form>

우리의 작업은 SQL은 아마 이렇게됩니다 :

username : = r.Form.Get ( "username")
password : = r.Form.Get ( "password")
sql : = "SELECT * FROM user WHERE username = '"+ username + "'AND password = '"+ password + "'"

만약 사용자가 다음과 같은 사용자 이름을 입력하고 암호가 임의 인 경우

myuser 'or'foo '='foo '-

우리의 SQL은 다음과 같습니다 :

SELECT * FROM user WHERE username = 'myuser'or 'foo'== 'foo'- 'AND password ='​​xxx '

SQL에서는`--` 댓글을 나타냅니다. 따라서 검색 쿼리는 도중에 중단됩니다. 공격자는 합법적 인 사용자 이름과 암호를 몰라도 로그인에 성공합니다.

MSSQL의 시스템을 제어하는​​ 더 위험한 SQL 인젝션 있습니다. 아래의 무서운 예에서는 버전의 경우 MSSQL 데이터베이스에서 어떻게 시스템 명령을 실행하거나 보여줍니다.

sql : = "SELECT * FROM products WHERE name LIKE '%'+ prod +"% ' "
Db.Exec (sql)

만약 공격에`a % 'exec master..xp_cmdshell'net user test testpass / ADD '--`이 prod 변수로 전송되면 sql은 다음과 같습니다

sql : = "SELECT * FROM products WHERE name LIKE '% a %'exec master..xp_cmdshell 'net user test testpass / ADD'- % '"

MSSQL 서버는 뒤에 시스템에 새로운 사용자를 추가하는 명령을 포함한 SQL 쿼리를 실행합니다. 만약이 프로그램이 sa로 실행되고, 또한 MSSQLSERVER 서비스에 충분한 권한이 있으면 공격자가 시스템 계정을 취득 호스트에 액세스 할 수 있습니다.

> 위 예제는 특정 데이터베이스 시스템에 있지만, 다른 데이터베이스 시스템에 유사한 공격을 실시 할 수없는 것을 나타내는 것은 아닙니다. 이러한 보안 홀은 다른 방법을 사용하면, 모든 데이터베이스에서 발생할 수 있습니다.


## 어떻게하여 SQL 인젝션을 예방하거나
공격자는 데이터베이스의 구조 정보를 알고 있지 않으면 SQL 인젝션 공격은 실시 할 수 없다고 생각 될지도 모릅니다. 확실히 그대로입니다 그러나 아무도 공격자가 이러한 정보를 얻을 수 없다고 보장 할 수 없습니다. 일단 그들의 손에 넘어 버리면, 데이터베이스는 위험합니다. 만약 BBS 프로그램 등 오픈 소스 소프트웨어 패키지를 사용하여 데이터베이스에 액세스하는면 공격자는 쉽게 관련 코드를 얻을 수 있습니다. 만약 이러한 코드의 설계에 결함이 있으면 위험은 더욱 커집니다. 현재 Discuz, phpwind, phpcms 등 유행의 오픈 소스 프로그램은 모두 SQL 인젝션 공격의 예입니다.

이러한 공격은 항상 보안 높지 않은 코드에서 발생합니다. 따라서 외계에서 입력 된 데이터는 영원히 믿지 마세요. 특히 셀렉트 박스 나 폼의 hidden 항목 cookie 등 사용자의 데이터가 있다고합니다. 위의 첫 번째 예와 같이 정상적인 검색도 재난으로 될 수 있습니다.

SQL 인젝션 공격의 피해는 이만큼 크고, 어떻게 예방하나요 있을까요? 다음의 이러한 제안은 혹시 SQL 인젝션 예방에 일정한 도움이 될지도 모릅니다.

1. Web 어플리케이션의 데이터베이스 작업 권한을 엄격히 제한한다. 이 사용자는 그 작업에 필요한 최소한의 권한 만 부여 가능한 SQL 인젝션 공격이 데이터베이스에주는 피해를 감소시킨다.
2. 입력 된 데이터가 기대하는 데이터 형식인지 검사하고 변수의 형식을 엄격하게 제한한다. 예를 들어 regexp 패키지를 사용하여 매칭 처리를 실시하거나 strconv 패키지를 사용하여 문자열을 다른 기본 형식의 데이터로 변환하여 판단한다.
3. 데이터베이스에 들어오는 특수 문자 ( ' "\ 대괄호 & *; 등)에 대해 이스케이프 처리를 실시하거나 인코딩 .Go의`text / template` 패키지에는`HTMLEscapeString` 함수가 문자 열에 대해 이스케이프 처리를 할 수 있습니다.
4. 모든 검색 쿼리에는 가급적 데이터베이스가 제공하는 매개 변수 검색 인터페이스를 사용한다. 파라미터 화 된 쿼리 매개 변수를 사용하여 사용자가 입력 한 변수를 SQL 쿼리에 포함되지 않습니다. 즉, 직접 SQL 쿼리를 조립한다는 것입니다. 예를 들어`database / sql`의 검색 함수`Prepare`와`Query`를 사용하거나`Exec (query string, args ... interface {})`을 사용합니다.
5. 응용 프로그램을 배포하기 전에 가급적 전문 SQL 주입 검사 도구를 사용하여 검사를 실시하여 발견 된 SQL 인젝션 보안 구멍에는 즉시 패치를 댄다. 넷상에서는이 방면의 오픈 소스 도구가 많이 있습니다. 예를 들어 sqlmap, SQLninja 등입니다.
6. 페이지에서 SQL의 오류 정보를 출력하는 것을 피한다. 예를 들어 유형의 오류 필드의 불일치 등입니다. 코드의 SQL 쿼리가 노출 됨으로써 공격자가 이러한 오류 정보를 이용하여 SQL 인젝션있는 것을 방지합니다.

## 정리
위의 예에 SQL 인젝션은 피해가 상당 할 보안 홀이라고 알았습니다. 따라서 우리가 일반적으로 쓰는 Web 응용 프로그램에는 어떤 작은 일에서도 매우 중시해야합니다. 작은 것이 운명을 나눕니다. 생활도 같은 Web 어플리케이션을 작성할 수도 마찬가지입니다.

